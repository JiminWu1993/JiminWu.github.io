<!-- 注意：这个文件需要被包含在index.html中 -->
<!-- 页面01 -->
<div id="2101" class="page">
    <img src="images/画面01.jpg" alt="Scene 01" class="background-img">
    <div class="text-display">Arturo: Hello, I'm Arturo Valdez.</div>
    <button class="continue-btn" onclick="navigateTo(2102)">Continue</button>
</div>

<!-- 页面02 -->
<div id="2102" class="page">
    <img src="images/画面02.jpg" alt="Scene 02" class="background-img">
    <div class="text-display">Alexa: Hi. My name (1) Alexandra Costa, but please (2) me Alexa.</div>
    
    <div class="button-group">
        <button class="option-btn" data-group="1" data-option="1" data-correct="true" onclick="selectOption(this)">is</button>
        <button class="option-btn" data-group="1" data-option="2" data-correct="false" onclick="selectOption(this)">am</button>
        <button class="option-btn" data-group="1" data-option="3" data-correct="false" onclick="selectOption(this)">are</button>
    </div>
    
    <div class="button-group">
        <button class="option-btn" data-group="2" data-option="1" data-correct="false" onclick="selectOption(this)">calls</button>
        <button class="option-btn" data-group="2" data-option="2" data-correct="true" onclick="selectOption(this)">call</button>
        <button class="option-btn" data-group="2" data-option="3" data-correct="false" onclick="selectOption(this)">calling</button>
    </div>
    
    <button class="continue-btn" onclick="navigateTo(2103)">Continue</button>
</div>

<!-- 页面03 -->
<div id="2103" class="page">
    <img src="images/画面03.jpg" alt="Scene 03" class="background-img">
    <div class="text-display">Arturo: OK. Where (3) you from, Alexa?</div>
    
    <div class="button-group">
        <button class="option-btn" data-group="3" data-option="1" data-correct="false" onclick="selectOption(this)">is</button>
        <button class="option-btn" data-group="3" data-option="2" data-correct="true" onclick="selectOption(this)">are</button>
        <button class="option-btn" data-group="3" data-option="3" data-correct="false" onclick="selectOption(this)">am</button>
    </div>
    
    <button class="continue-btn" onclick="navigateTo(2104)">Continue</button>
</div>

<!-- 页面04 -->
<div id="2104" class="page">
    <img src="images/画面04.jpg" alt="Scene 04" class="background-img">
    <div class="text-display">Alexa: Brazil. How about you?</div>
    <button class="continue-btn" onclick="navigateTo(2105)">Continue</button>
</div>

<!-- 页面05 -->
<div id="2105" class="page">
    <img src="images/画面05.jpg" alt="Scene 05" class="background-img">
    <div class="text-display">Arturo: I'm from Mexico. I (4) here in the city now, but my family (5) in a small town near Guadalajara.</div>
    
    <div class="button-group">
        <button class="option-btn" data-group="4" data-option="1" data-correct="true" onclick="selectOption(this)">lives</button>
        <button class="option-btn" data-group="4" data-option="2" data-correct="false" onclick="selectOption(this)">live</button>
        <button class="option-btn" data-group="4" data-option="3" data-correct="false" onclick="selectOption(this)">living</button>
    </div>
    
    <div class="button-group">
        <button class="option-btn" data-group="5" data-option="1" data-correct="true" onclick="selectOption(this)">lives</button>
        <button class="option-btn" data-group="5" data-option="2" data-correct="false" onclick="selectOption(this)">live</button>
        <button class="option-btn" data-group="5" data-option="3" data-correct="false" onclick="selectOption(this)">are living</button>
    </div>
    
    <button class="continue-btn" onclick="navigateTo(2106)">Continue</button>
</div>

<!-- 页面06 -->
<div id="2106" class="page">
    <img src="images/画面06.jpg" alt="Scene 06" class="background-img">
    <div class="text-display">Alexa: Oh, I (6) Mexico! It (7) really beautiful. My brother (8) Mexico, too. Oh, good. Soo-jin (9) here.</div>
    
    <div class="button-group">
        <button class="option-btn" data-group="6" data-option="1" data-correct="false" onclick="selectOption(this)">loves</button>
        <button class="option-btn" data-group="6" data-option="2" data-correct="true" onclick="selectOption(this)">love</button>
        <button class="option-btn" data-group="6" data-option="3" data-correct="false" onclick="selectOption(this)">loving</button>
    </div>
    
    <div class="button-group">
        <button class="option-btn" data-group="7" data-option="1" data-correct="true" onclick="selectOption(this)">is</button>
        <button class="option-btn" data-group="7" data-option="2" data-correct="false" onclick="selectOption(this)">am</button>
        <button class="option-btn" data-group="7" data-option="3" data-correct="false" onclick="selectOption(this)">are</button>
    </极>
    
    <div class="button-group">
        <button class="option-btn" data-group="8极 data-option="1" data-correct="true" onclick="selectOption(this)">loves</button>
        <button class="option-btn" data-group="8" data-option="2" data-correct="false" onclick="selectOption(this)">love</button>
        <button class="option-btn" data-group="8" data-option="3" data-correct="false" onclick="selectOption(this)">loving</button>
    </div>
    
    <div class="button-group">
        <button class="option-btn" data-group="9" data-option="1" data-correct="true" onclick="极selectOption(this)">is</button>
        <button class="option-btn" data-group="9" data-option="2" data-correct="false" onclick="selectOption(this)">are</button>
        <button class="option-btn" data-group="9" data-option="3" data-correct="false" onclick="selectOption(this)">am</button>
    </div>
    
    <button class="continue-btn" onclick="navigateTo(2107)">Continue</button>
</div>

<!-- 更多页面会按照相同模式继续实现 -->
<!-- 由于篇幅限制，这里只展示了部分页面，完整实现需要包含所有21个页面 -->

<!-- 页面21 - 得分画面 -->
<div id="2121" class="page">
    <img id="result-img" src="" alt="Result" class="background-img">
    <div class="score-display">Your score: <span id="final-score">0</span></div>
</div>

<script>
    // 选项选择函数
    function selectOption(button) {
        const group = button.dataset.group;
        const option = button.dataset.option;
        const isCorrect = button.dataset.correct === "true";
        
        // 重置同组按钮样式
        const groupButtons = document.querySelectorAll(`.option-btn[data-group="${group}"]`);
        groupButtons.forEach(btn => {
            btn.classList.remove('selected');
            btn.classList.remove('correct');
            btn.classList.remove('incorrect');
        });
        
        // 设置当前选中按钮样式
        button.classList.add('selected');
        if (isCorrect) {
            button.classList.add('correct');
        } else {
            button.classList.add('incorrect');
        }
        
        // 记录选择
        gameState.selectedOptions[group] = {
            option: option,
            correct: isCorrect
        };
    }
    
    // 计算得分并保存到Firebase
    async function calculateScore() {
        let correctCount = 0;
        
        // 只计算第22组到第43组按钮
        for (let i = 22; i <= 43; i++) {
            if (gameState.selectedOptions[i] && gameState.selectedOptions[i].correct) {
                correctCount++;
            }
        }
        
        // 计算最终得分 (correctCount * 4.55) 并四舍五入到整数
        gameState.score = Math.round(correctCount * 4.55);
        
        // 生成房间号 (月日时分)
        const now = new Date();
        const month = (now.getMonth() + 1).toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const roomId = month + day + hours + minutes;
        
        // 保存得分到Firebase
        try {
            await database.ref('scores/' + roomId).set({
                score: gameState.score,
                timestamp: now.getTime()
            });
        } catch (error) {
            console.error("Error saving score to Firebase:", error);
            // 即使保存失败也继续显示得分
        }
        
        // 显示得分
        document.getElementById('final-score').textContent = gameState.score;
        
        // 设置结果图片
        const resultImg = document.getElementById('result-img');
        if (gameState.score >= 60) {
            resultImg.src = "images/及格.jpg";
        } else {
            resultImg.src = "images/不及格.jpg";
        }
        
        // 导航到得分页面
        navigateTo(2121);
    }
</script>
