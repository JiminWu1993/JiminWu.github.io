<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>英语时态之旅</title>
    <style>
        /* 基础样式设置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: black;
            color: white;
            font-size: 16px;
            line-height: 1.5;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        /* 游戏页面容器 */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        .screen.active {
            display: flex;
            opacity: 1;
        }
        
        /* 图片样式 */
        .screen-image {
            width: 100%;
            object-fit: cover;
            display: block;
        }
        
        /* 文字内容区域 */
        .text-content {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 按钮容器 */
        .buttons-container {
            width: 100%;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-grow: 1;
            justify-content: flex-start;
        }
        
        /* 按钮行 */
        .button-row {
            display: flex;
            width: 100%;
            gap: 10px;
            justify-content: space-between;
        }
        
        /* 选项按钮样式 */
        .option-button {
            flex: 1;
            padding: 12px 5px;
            background-color: #1E90FF;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-button.selected {
            background-color: #0066CC;
            font-weight: bold;
        }
        
        .option-button:not(.selected) {
            opacity: 0.7;
        }
        
        /* Continue按钮样式 */
        .continue-button {
            width: 100%;
            padding: 15px;
            background-color: #1E90FF;
            color: white;
            border: none;
            font-size: 18px;
            cursor: pointer;
            margin-top: auto;
        }
        
        /* 提示框样式 */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: blue;
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 80%;
        }
        
        /* 开始画面特殊按钮布局 */
        #screen-2100 .button-row {
            justify-content: space-around;
        }
        
        #screen-2100 .option-button {
            flex: 0 0 45%;
        }
    </style>
</head>
<body>
    <!-- 消息提示框 -->
    <div class="message-box" id="message-box"></div>
    
    <!-- 开始画面 -->
    <div id="screen-2100" class="screen active">
        <img src="images/开始画面.jpg" alt="开始画面" class="screen-image">
        <div class="text-content">Welcome to the journey of English tenses</div>
        <div class="buttons-container">
            <div class="button-row">
                <button class="option-button" data-next="2101">Begin</button>
            </div>
        </div>
    </div>
    
    <!-- 其他画面将通过JavaScript动态生成 -->
    
    <script>
        // 游戏数据定义
        const gameData = [
            {
                id: 2100,
                image: "开始画面.jpg",
                text: "Welcome to the journey of English tenses",
                buttons: [
                    { text: "Begin", correct: null, next: 2101 }
                ],
                isScoring: false
            },
            {
                id: 2101,
                image: "画面01.jpg",
                text: "Arturo: Hello, I'm Arturo Valdez.",
                buttons: [
                    { text: "Continue", correct: null, next: 2102 }
                ],
                isScoring: false
            },
            {
                id: 2102,
                image: "画面02.jpg",
                text: "Alexa: Hi. My name (1) Alexandra Costa, but please (2) me Alexa.",
                buttons: [
                    { text: "is", correct: true, group: 1 },
                    { text: "am", correct: false, group: 1 },
                    { text: "are", correct: false, group: 1 },
                    { text: "calls", correct: false, group: 2 },
                    { text: "call", correct: true, group: 2 },
                    { text: "calling", correct: false, group: 2 },
                    { text: "Continue", correct: null, next: 2103 }
                ],
                isScoring: false
            },
            // 其他关卡数据...
            // 由于篇幅限制，这里只展示部分数据，实际代码中需要包含所有关卡数据
            {
                id: 2113,
                image: "画面13.jpg",
                text: "My name's Nick. My girlfriend's name (1) Karen. We (2) students. I (3) to university in Oxford.",
                buttons: [
                    { text: "is", correct: true, group: 22 },
                    { text: "are", correct: false, group: 22 },
                    { text: "am", correct: false, group: 22 },
                    { text: "is", correct: false, group: 23 },
                    { text: "are", correct: true, group: 23 },
                    { text: "am", correct: false, group: 23 },
                    { text: "go", correct: true, group: 24 },
                    { text: "goes", correct: false, group: 24 },
                    { text: "going", correct: false, group: 24 },
                    { text: "Continue", correct: null, next: 2114 }
                ],
                isScoring: true
            },
            // 继续添加所有关卡数据...
            {
                id: 2121,
                image: "", // 根据得分动态设置
                text: "", // 根据得分动态设置
                buttons: [],
                isScoring: false,
                isScoreScreen: true
            }
        ];

        // 游戏状态管理
        let gameState = {
            currentScreen: 2100,
            score: 0,
            selectedOptions: {},
            preloadedImages: {}
        };

        // DOM加载完成后初始化游戏
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            preloadNextImage(2101); // 预加载下一张图片
        });

        // 初始化游戏
        function initializeGame() {
            // 创建所有游戏画面
            createGameScreens();
            
            // 添加事件监听器
            document.addEventListener('click', function(e) {
                // 处理选项按钮点击
                if (e.target.classList.contains('option-button') && !e.target.classList.contains('continue-button')) {
                    handleOptionClick(e.target);
                }
                
                // 处理Continue按钮点击
                if (e.target.classList.contains('continue-button')) {
                    handleContinueClick(e.target);
                }
            });
        }

        // 创建所有游戏画面
        function createGameScreens() {
            const gameContainer = document.body;
            
            // 从第二个画面开始创建（第一个画面已存在）
            for (let i = 1; i < gameData.length; i++) {
                const screenData = gameData[i];
                const screen = document.createElement('div');
                screen.id = `screen-${screenData.id}`;
                screen.className = 'screen';
                
                // 创建图片元素
                const img = document.createElement('img');
                img.src = `images/${screenData.image}`;
                img.alt = `画面${screenData.id}`;
                img.className = 'screen-image';
                screen.appendChild(img);
                
                // 创建文本内容区域
                const textDiv = document.createElement('div');
                textDiv.className = 'text-content';
                textDiv.textContent = screenData.text;
                screen.appendChild(textDiv);
                
                // 创建按钮容器
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'buttons-container';
                
                // 对于计分画面，特殊处理
                if (screenData.isScoreScreen) {
                    // 得分画面将在显示时动态更新
                } else {
                    // 分组按钮
                    const buttonGroups = {};
                    
                    // 组织按钮按组分类
                    screenData.buttons.forEach(button => {
                        if (button.group) {
                            if (!buttonGroups[button.group]) {
                                buttonGroups[button.group] = [];
                            }
                            buttonGroups[button.group].push(button);
                        }
                    });
                    
                    // 创建分组按钮行
                    for (const group in buttonGroups) {
                        const row = document.createElement('div');
                        row.className = 'button-row';
                        
                        buttonGroups[group].forEach(button => {
                            const btn = document.createElement('button');
                            btn.className = 'option-button';
                            btn.textContent = button.text;
                            btn.dataset.correct = button.correct;
                            btn.dataset.group = button.group;
                            row.appendChild(btn);
                        });
                        
                        buttonsContainer.appendChild(row);
                    }
                    
                    // 添加Continue按钮
                    const continueButton = screenData.buttons.find(b => b.next);
                    if (continueButton) {
                        const btn = document.createElement('button');
                        btn.className = 'option-button continue-button';
                        btn.textContent = continueButton.text;
                        btn.dataset.next = continueButton.next;
                        buttonsContainer.appendChild(btn);
                    }
                }
                
                screen.appendChild(buttonsContainer);
                gameContainer.appendChild(screen);
            }
        }

        // 处理选项按钮点击
        function handleOptionClick(button) {
            const screenId = parseInt(button.closest('.screen').id.split('-')[1]);
            const group = button.dataset.group;
            
            if (!group) return; // 非选项按钮
            
            // 取消同组其他按钮的选中状态
            const groupButtons = button.closest('.button-row').querySelectorAll('.option-button');
            groupButtons.forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // 设置当前按钮为选中状态
            button.classList.add('selected');
            
            // 保存选择
            if (!gameState.selectedOptions[screenId]) {
                gameState.selectedOptions[screenId] = {};
            }
            gameState.selectedOptions[screenId][group] = button.dataset.correct === 'true';
        }

        // 处理Continue按钮点击
        function handleContinueClick(button) {
            const currentScreen = button.closest('.screen');
            const currentScreenId = parseInt(currentScreen.id.split('-')[1]);
            const nextScreenId = parseInt(button.dataset.next);
            
            // 检查是否所有必选按钮都已选择
            const screenData = gameData.find(s => s.id === currentScreenId);
            const hasGroupButtons = screenData.buttons.some(b => b.group);
            
            if (hasGroupButtons) {
                const selectedOptions = gameState.selectedOptions[currentScreenId] || {};
                const requiredGroups = [];
                
                screenData.buttons.forEach(b => {
                    if (b.group && !requiredGroups.includes(b.group)) {
                        requiredGroups.push(b.group);
                    }
                });
                
                const selectedGroups = Object.keys(selectedOptions);
                if (selectedGroups.length < requiredGroups.length) {
                    showMessage("请完成所有选项后再继续");
                    return;
                }
            }
            
            // 计算得分（如果是计分关卡）
            if (screenData.isScoring) {
                calculateScore(currentScreenId);
            }
            
            // 切换到下一画面
            switchScreen(nextScreenId);
            
            // 预加载下一张图片
            const nextScreenData = gameData.find(s => s.id === nextScreenId);
            if (nextScreenData && nextScreenData.next) {
                preloadNextImage(nextScreenData.next);
            }
        }

        // 计算得分
        function calculateScore(screenId) {
            const selectedOptions = gameState.selectedOptions[screenId] || {};
            
            for (const group in selectedOptions) {
                if (selectedOptions[group]) {
                    gameState.score++;
                }
            }
        }

        // 切换画面
        function switchScreen(screenId) {
            // 隐藏当前画面
            const currentScreen = document.querySelector('.screen.active');
            if (currentScreen) {
                currentScreen.classList.remove('active');
            }
            
            // 显示新画面
            const newScreen = document.getElementById(`screen-${screenId}`);
            if (newScreen) {
                newScreen.classList.add('active');
                
                // 如果是得分画面，特殊处理
                if (screenId === 2121) {
                    showScoreScreen();
                }
            }
        }

        // 显示得分画面
        function showScoreScreen() {
            const scoreScreen = document.getElementById('screen-2121');
            const totalScore = Math.floor(gameState.score * (100 / 22));
            
            // 设置图片和文本
            const img = scoreScreen.querySelector('.screen-image');
            const textDiv = scoreScreen.querySelector('.text-content');
            
            img.src = totalScore >= 60 ? 'images/及格.jpg' : 'images/不及格.jpg';
            textDiv.textContent = `您的得分: ${totalScore}`;
            
            // 清空按钮容器并添加重新开始按钮
            const buttonsContainer = scoreScreen.querySelector('.buttons-container');
            buttonsContainer.innerHTML = '';
            
            const restartButton = document.createElement('button');
            restartButton.className = 'option-button continue-button';
            restartButton.textContent = '重新开始';
            restartButton.addEventListener('click', restartGame);
            buttonsContainer.appendChild(restartButton);
        }

        // 显示消息
        function showMessage(message) {
            const messageBox = document.getElementById('message-box');
            messageBox.textContent = message;
            messageBox.style.display = 'block';
            
            // 3秒后隐藏消息
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }

        // 预加载图片
        function preloadNextImage(nextScreenId) {
            const nextScreenData = gameData.find(s => s.id === nextScreenId);
            if (!nextScreenData || gameState.preloadedImages[nextScreenId]) return;
            
            const img = new Image();
            img.src = `images/${nextScreenData.image}`;
            img.onload = function() {
                gameState.preloadedImages[nextScreenId] = true;
            };
        }

        // 重新开始游戏
        function restartGame() {
            // 重置游戏状态
            gameState = {
                currentScreen: 2100,
                score: 0,
                selectedOptions: {},
                preloadedImages: {}
            };
            
            // 切换到开始画面
            switchScreen(2100);
            
            // 重新预加载第一张图片
            preloadNextImage(2101);
        }

        // 错误处理：图片加载失败
        document.addEventListener('error', function(e) {
            if (e.target.tagName === 'IMG') {
                console.error('图片加载失败:', e.target.src);
                showMessage('图片加载失败，请检查图片路径');
            }
        }, true);
    </script>
</body>
</html>
