<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>英语时态之旅</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Microsoft+YaHei&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 游戏开始界面 -->
    <div id="start-screen" class="screen active">
        <img src="images/开始画面.jpg" alt="开始画面" class="game-image">
        <div class="text-display">Welcome to the journey of English tenses</div>
        <div class="button-container">
            <button id="start-game" class="game-button">Begin the game</button>
        </div>
    </div>

    <!-- 游戏章节内容将通过JavaScript动态加载 -->
    <div id="game-container"></div>

    <!-- 预加载图片的隐藏元素 -->
    <div id="preload-images" style="display: none;"></div>

    <script>
        // 游戏数据
        const gameData = {
            scenes: [
                // 开始画面 (ID:2001)
                {
                    id: 2001,
                    image: "开始画面.jpg",
                    text: "Welcome to the journey of English tenses",
                    buttons: [
                        { text: "Begin the game", target: 2101, isContinue: true }
                    ]
                },
                // 场景1-11 (ID:2101-2111)
                {
                    id: 2101,
                    image: "画面01.jpg",
                    text: "Arturo: Hello, I'm Arturo Valdez.",
                    buttons: [
                        { text: "Continue", target: 2102, isContinue: true }
                    ]
                },
                {
                    id: 2102,
                    image: "画面02.jpg",
                    text: "Alexa: Hi. My name (1) Alexandra Costa, but please (2) me Alexa.",
                    buttonGroups: [
                        {
                            id: "group1",
                            buttons: [
                                { text: "is", correct: true, groupId: "1" },
                                { text: "am", correct: false, groupId: "1" },
                                { text: "are", correct: false, groupId: "1" }
                            ]
                        },
                        {
                            id: "group2",
                            buttons: [
                                { text: "calls", correct: false, groupId: "2" },
                                { text: "call", correct: true, groupId: "2" },
                                { text: "calling", correct: false, groupId: "2" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2103, isContinue: true }
                    ]
                },
                {
                    id: 2103,
                    image: "画面03.jpg",
                    text: "Arturo: OK. Where (3) you from, Alexa?",
                    buttonGroups: [
                        {
                            id: "group3",
                            buttons: [
                                { text: "is", correct: false, groupId: "3" },
                                { text: "are", correct: true, groupId: "3" },
                                { text: "am", correct: false, groupId: "3" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2104, isContinue: true }
                    ]
                },
                {
                    id: 2104,
                    image: "画面04.jpg",
                    text: "Alexa: Brazil. How about you?",
                    buttons: [
                        { text: "Continue", target: 2105, isContinue: true }
                    ]
                },
                {
                    id: 2105,
                    image: "画面05.jpg",
                    text: "Arturo: I'm from Mexico. I (4) here in the city now, but my family (5) in a small town near Guadalajara.",
                    buttonGroups: [
                        {
                            id: "group4",
                            buttons: [
                                { text: "lives", correct: true, groupId: "4" },
                                { text: "live", correct: false, groupId: "4" },
                                { text: "living", correct: false, groupId: "4" }
                            ]
                        },
                        {
                            id: "group5",
                            buttons: [
                                { text: "lives", correct: true, groupId: "5" },
                                { text: "live", correct: false, groupId: "5" },
                                { text: "are living", correct: false, groupId: "5" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2106, isContinue: true }
                    ]
                },
                {
                    id: 2106,
                    image: "画面06.jpg",
                    text: "Alexa: Oh, I (6) Mexico! It (7) really beautiful. My brother (8) Mexico, too. Oh, good. Soo-jin (9) here.",
                    buttonGroups: [
                        {
                            id: "group6",
                            buttons: [
                                { text: "loves", correct: false, groupId: "6" },
                                { text: "love", correct: true, groupId: "6" },
                                { text: "loving", correct: false, groupId: "6" }
                            ]
                        },
                        {
                            id: "group7",
                            buttons: [
                                { text: "is", correct: true, groupId: "7" },
                                { text: "am", correct: false, groupId: "7" },
                                { text: "are", correct: false, groupId: "7" }
                            ]
                        },
                        {
                            id: "group8",
                            buttons: [
                                { text: "loves", correct: true, groupId: "8" },
                                { text: "love", correct: false, groupId: "8" },
                                { text: "loving", correct: false, groupId: "8" }
                            ]
                        },
                        {
                            id: "group9",
                            buttons: [
                                { text: "is", correct: true, groupId: "9" },
                                { text: "are", correct: false, groupId: "9" },
                                { text: "am", correct: false, groupId: "9" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2107, isContinue: true }
                    ]
                },
                {
                    id: 2107,
                    image: "画面07.jpg",
                    text: "Arturo: Who (10) Soo-jin? She (11) familiar.",
                    buttonGroups: [
                        {
                            id: "group10",
                            buttons: [
                                { text: "is", correct: true, groupId: "10" },
                                { text: "are", correct: false, groupId: "10" },
                                { text: "am", correct: false, groupId: "10" }
                            ]
                        },
                        {
                            id: "group11",
                            buttons: [
                                { text: "looks", correct: true, groupId: "11" },
                                { text: "look", correct: false, groupId: "11" },
                                { text: "looking", correct: false, groupId: "11" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2108, isContinue: true }
                    ]
                },
                {
                    id: 2108,
                    image: "画面08.jpg",
                    text: "Alexa: She (12) my classmate. We (13) in the same business class. We (14) our class every Monday and Wednesday.",
                    buttonGroups: [
                        {
                            id: "group12",
                            buttons: [
                                { text: "is", correct: false, groupId: "12" },
                                { text: "are", correct: true, groupId: "12" },
                                { text: "am", correct: false, groupId: "12" }
                            ]
                        },
                        {
                            id: "group13",
                            buttons: [
                                { text: "is", correct: false, groupId: "13" },
                                { text: "are", correct: true, groupId: "13" },
                                { text: "am", correct: false, groupId: "13" }
                            ]
                        },
                        {
                            id: "group14",
                            buttons: [
                                { text: "has", correct: false, groupId: "14" },
                                { text: "have", correct: true, groupId: "14" },
                                { text: "having", correct: false, groupId: "14" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2109, isContinue: true }
                    ]
                },
                {
                    id: 2109,
                    image: "画面09.jpg",
                    text: "Arturo: Where (15) she from?",
                    buttonGroups: [
                        {
                            id: "group15",
                            buttons: [
                                { text: "is", correct: false, groupId: "15" },
                                { text: "are", correct: true, groupId: "15" },
                                { text: "am", correct: false, groupId: "15" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2110, isContinue: true }
                    ]
                },
                {
                    id: 2110,
                    image: "画面10.jpg",
                    text: "Alexa: South Korea. She (16) marketing. She (17) the classes (18) very interesting. Let's go and say hello. Sorry, what (19) your last name again? Vargas?",
                    buttonGroups: [
                        {
                            id: "group16",
                            buttons: [
                                { text: "studies", correct: true, groupId: "16" },
                                { text: "study", correct: false, groupId: "16" },
                                { text: "studying", correct: false, groupId: "16" }
                            ]
                        },
                        {
                            id: "group17",
                            buttons: [
                               极 { text: "says", correct: true, groupId: "17" },
                                { text: "say", correct: false, groupId: "17" },
                                { text: "saying", correct: false, groupId: "17" }
                            ]
                        },
                        {
                            id: "group18",
                            buttons: [
                                { text: "is", correct: false, groupId: "18" },
                                { text极: "are", correct: true, groupId: "18" },
                                { text: "am", correct: false, groupId: "18" }
                            ]
                        },
                        {
                            id: "group19",
                            buttons: [
                                { text: "is", correct: true, groupId: "19" },
                                { text: "are", correct: false, groupId: "19" },
                                { text: "am", correct: false, groupId: "19" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2111, isContinue: true }
                    ]
                },
                {
                    id: 2111,
                    image: "画面11.jpg",
                    text: "Arturo: Actually, it (20) Valdez",
                    buttonGroups: [
                        {
                            id: "group20",
                            buttons: [
                                { text: "is", correct: true, groupId: "20" },
                                { text: "are", correct: false, groupId: "20" },
                                { text: "am", correct: false, groupId:极 "20" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2112, isContinue: true }
                    ]
                },
                {
                    id: 2112,
                    image: "画面12.jpg",
                    text: "Alexa: How (21) you spell that?",
                    buttonGroups: [
                        {
                            id: "group21",
                            buttons: [
                                { text: "is", correct: false, groupId: "21" },
                                { text: "are", correct: true, groupId: "21" },
                                { text: "am", correct: false, groupId: "21" }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2113, isContinue: true }
                    ]
                },
                // 计分场景 13-20 (ID:2113-2120)
                {
                    id: 2113,
                    image: "画面13.jpg",
                    text: "My name's Nick. My girlfriend's name (1) Karen. We (2) students. I (3) to university in Oxford.",
                    buttonGroups: [
                        {
                            id: "group22",
                            buttons: [
                                { text: "is", correct: true, groupId: "22", score: true },
                                { text: "are", correct: false, groupId: "22", score: true },
                                { text: "am", correct: false, groupId: "22", score: true }
                            ]
                        },
                        {
                            id: "group23",
                            buttons: [
                                { text: "is", correct: false, groupId: "23", score: true },
                                { text: "are", correct: true, groupId: "23", score: true },
                                { text: "am", correct: false, groupId: "23", score: true }
                            ]
                        },
                        {
                            id: "group24",
                            buttons: [
                                { text: "go", correct: true, groupId: "24", score: true },
                                { text: "goes", correct: false, groupId: "极24", score: true },
                                { text: "going", correct: false, groupId: "24", score: true }
                            ]
                        }
                    ],
                    buttons: [
                        { text: "Continue", target: 2114, isContinue: true }
                    ]
                },
                // 为节省篇幅，这里省略了部分场景数据，实际代码中需要完整实现
                // 最终得分场景
                {
                    id: 2121,
                    text: "",
                    buttons: [
                        { text: "Play Again", target: 2001, isContinue: true }
                    ]
                }
            ],
            currentScene: 2001,
            score: 0,
            selectedAnswers: {}
        };

        // 游戏初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 预加载图片
            preloadImages();
            
            // 开始游戏按钮事件
            document.getElementById('start-game').addEventListener('click', function() {
                loadScene(2101);
            });
        });

        // 预加载图片
        function preloadImages() {
            const preloadContainer = document.getElementById('preload-images');
            gameData.scenes.forEach(scene => {
                if (scene.image) {
                    const img = document.createElement('img');
                    img.src = 'images/' + scene.image;
                    preloadContainer.appendChild(img);
                }
            });
        }

        // 加载场景
        function loadScene(sceneId) {
            const scene = gameData.scenes.find(s => s.id === sceneId);
            if (!scene) return;
            
            gameData.currentScene = sceneId;
            
            // 隐藏开始界面
            document.getElementById('start-screen').classList.remove('active');
            
            // 创建场景容器
            const gameContainer = document.getElementById('game-container');
            gameContainer.innerHTML = '';
            
            // 创建场景元素
            const sceneElement = document.createElement('div');
            sceneElement.className = 'screen scene';
            sceneElement.dataset.sceneId = sceneId;
            
            // 添加图片
            if (scene.image) {
                const img = document.createElement('img');
                img.src = 'images/' + scene.image;
                img.alt = '场景图片';
                img.className = 'game-image fade-in';
                sceneElement.appendChild(img);
            }
            
            // 添加文本显示
            const textDisplay = document.createElement('div');
            textDisplay.className = 'text-display';
            textDisplay.textContent = scene.text;
            sceneElement.appendChild(textDisplay);
            
            // 添加按钮组
            if (scene.buttonGroups) {
                const buttonGroupsContainer = document.createElement('div');
                buttonGroupsContainer.className = 'button-groups-container';
                
                scene.buttonGroups.forEach(group => {
                    const buttonGroup = document.createElement('div');
                    buttonGroup.className = 'button-group';
                    
                    group.buttons.forEach(btn => {
                        const button = document.createElement('button');
                        button.className = 'option-button';
                        button.textContent = btn.text;
                        button.dataset.groupId = btn.groupId;
                        button.dataset.correct = btn.correct;
                        if (btn.score) {
                            button.dataset.score = true;
                        }
                        
                        button.addEventListener('click', function() {
                            handleOptionClick(this, group.id);
                        });
                        
                        buttonGroup.appendChild(button);
                    });
                    
                    buttonGroupsContainer.appendChild(buttonGroup);
                });
                
                sceneElement.appendChild(buttonGroupsContainer);
            }
            
            // 添加继续按钮
            if (scene.buttons) {
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'button-container';
                
                scene.buttons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = 'game-button';
                    button.textContent = btn.text;
                    button.dataset.target = btn.target;
                    
                    button.addEventListener('click', function() {
                        if (btn.isContinue) {
                            handleContinueClick(this);
                        }
                    });
                    
                    buttonsContainer.appendChild(button);
                });
                
                sceneElement.appendChild(buttonsContainer);
            }
            
            // 添加到游戏容器
            gameContainer.appendChild(sceneElement);
            
            // 添加淡入效果
            setTimeout(() => {
                sceneElement.classList.add('active');
            }, 100);
        }

        // 处理选项按钮点击
        function handleOptionClick(button, groupId) {
            // 获取同一组的所有按钮
            const groupButtons = document.querySelectorAll(`.option-button[data-group-id="${button.dataset.groupId}"]`);
            
            // 重置所有按钮状态
            groupButtons.forEach(btn => {
                btn.classList.remove('selected');
                btn.classList.remove('correct');
                btn.classList.remove('incorrect');
            });
            
            // 设置当前按钮为选中状态
            button.classList.add('selected');
            
            // 存储选择的答案
            gameData.selectedAnswers[button.dataset.groupId] = {
                correct: button.dataset.correct === 'true',
                score: button.dataset.score === 'true'
            };
        }

        // 处理继续按钮点击
        function handleContinueClick(button) {
            const targetSceneId = parseInt(button.dataset.target);
            
            // 计算得分（仅对计分题目）
            if (gameData.currentScene >= 2113 && gameData.currentScene <= 2120) {
                Object.values(gameData.selectedAnswers).forEach(answer => {
                    if (answer.score && answer.correct) {
                        gameData.score++;
                    }
                });
            }
            
            // 如果是最终场景，显示得分
            if (targetSceneId === 2121) {
                showScore();
                return;
            }
            
            // 加载下一个场景
            loadScene(targetSceneId);
        }

        // 显示得分
        function showScore() {
            const totalScore = Math.floor(gameData.score * (100 / 22));
            const passed = totalScore >= 60;
            
            const gameContainer = document.getElementById('game-container');
            gameContainer.innerHTML = '';
            
            const scoreScreen = document.createElement('div');
            scoreScreen.className = 'screen scene active';
            
            // 添加图片
            const img = document.createElement('img');
            img.src = 'images/' + (passed ? '及格.jpg' : '不及格.jpg');
            img.alt = '得分画面';
            img.className = 'game-image fade-in';
            scoreScreen.appendChild(img);
            
            // 添加得分显示
            const scoreDisplay = document.createElement('div');
            scoreDisplay.className = 'score-display';
            scoreDisplay.textContent = `得分: ${totalScore}`;
            scoreScreen.appendChild(scoreDisplay);
            
            // 添加再玩一次按钮
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'button-container';
            
            const playAgainButton = document.createElement('button');
            playAgainButton.className = 'game-button';
            playAgainButton.textContent = 'Play Again';
            playAgainButton.addEventListener('click', function() {
                // 重置游戏数据
                gameData.score = 0;
                gameData.selectedAnswers = {};
                loadScene(2001);
            });
            
            buttonContainer.appendChild(playAgainButton);
            scoreScreen.appendChild(buttonContainer);
            
            gameContainer.appendChild(scoreScreen);
        }
    </script>
</body>
</html>
